
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation pour construire un homelab s√©curis√© et complet">
      
      
        <meta name="author" content="krhsaay">
      
      
      
        <link rel="prev" href="../vaultwarden/">
      
      
        <link rel="next" href="../siem/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.15">
    
    
      
        <title>Authentification MFA - Homelab Doc</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#authentification-centralisee-et-mfa-dans-un-homelab" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-t√™te">
    <a href="../.." title="Homelab Doc" class="md-header__button md-logo" aria-label="Homelab Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Homelab Doc
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Authentification MFA
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Homelab Doc" class="md-nav__button md-logo" aria-label="Homelab Doc" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Homelab Doc
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accueil
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üèó Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            üèó Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/proxmox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proxmox VE
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/stockage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stockage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/reseau/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    R√©seau & VLANs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infrastructure/lxc-vs-vm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LXC vs VM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üåê R√©seau
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            üåê R√©seau
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dashboards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/dns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DNS (Pi-hole, AdGuard...)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/vpn-remote-access/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Acc√®s VPN distant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/reverse-proxy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reverse Proxy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/ddns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DNS Dynamique (DDNS)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reseau/torrent-vpn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VPN et torrents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üß∞ Outils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            üß∞ Outils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outils/gestion-fichiers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gestion de fichiers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outils/gestion-mots-de-passe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mots de passe (Vaultwarden...)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outils/favoris/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Favoris et veille (Hoarder)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../outils/docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker & Portainer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üì∫ M√©dia
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            üì∫ M√©dia
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../media/streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Streaming (Jellyfin, Plex)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../media/overseerr-sonarr/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sonarr, Overseerr
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../media/clients-download.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T√©l√©chargements (qBittorrent)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../media/photos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Photos (Immich)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üè† Domotique
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            üè† Domotique
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domotique/homeassistant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home Assistant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domotique/zigbee/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zigbee2MQTT
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../domotique/surveillance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vid√©osurveillance (Frigate)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üìä Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            üìä Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grafana
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/prometheus-influx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus / InfluxDB
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring/netalert/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NetAlertX
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üîê S√©curit√©
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            üîê S√©curit√©
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vaultwarden/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vaultwarden
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Authentification MFA
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Authentification MFA
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table des mati√®res">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des mati√®res
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#solutions-open-source-de-gestion-didentite-et-sso" class="md-nav__link">
    <span class="md-ellipsis">
      Solutions open-source de gestion d‚Äôidentit√© et SSO
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#methodes-dauthentification-et-mfa-supportees" class="md-nav__link">
    <span class="md-ellipsis">
      M√©thodes d‚Äôauthentification et MFA support√©es
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cas-dusage-dans-un-homelab" class="md-nav__link">
    <span class="md-ellipsis">
      Cas d‚Äôusage dans un homelab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architectures-type-avec-reverse-proxy-et-sso" class="md-nav__link">
    <span class="md-ellipsis">
      Architectures type avec reverse proxy et SSO
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exemples-de-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Exemples de configuration
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resume" class="md-nav__link">
    <span class="md-ellipsis">
      R√©sum√©
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../siem/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SIEM (Wazuh, ELK...)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../segmentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Segmentation & honeypots
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    üß™ DIY
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            üß™ DIY
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diy/esp32/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ESP32 & capteurs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diy/octoprint.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OctoPrint & impression 3D
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../diy/n8n.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    N8N Automatisation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="authentification-centralisee-et-mfa-dans-un-homelab"><strong>Authentification centralis√©e et MFA dans un homelab</strong><a class="headerlink" href="#authentification-centralisee-et-mfa-dans-un-homelab" title="Permanent link">&para;</a></h1>
<p>Dans un  <strong>homelab</strong>  self-hosted, disposer d‚Äôun syst√®me d‚Äôauthentification centralis√©e robuste avec MFA (authentification multifacteur) permet de s√©curiser efficacement l‚Äôacc√®s √† l‚Äôensemble des services internes (NAS, serveurs, applications web, etc.). Cette documentation compare plusieurs solutions open-source (Keycloak, Authentik, Authelia, LemonLDAP::NG‚Ä¶), d√©taille les m√©thodes d‚Äôauthentification/MFA disponibles (TOTP, WebAuthn/U2F, SMS, push, YubiKey, etc.), propose des cas d‚Äôusage concrets (Vaultwarden, Nextcloud, Proxmox, Grafana‚Ä¶) et d√©crit des architectures types avec reverse proxy (NGINX Proxy Manager, Traefik) et SSO via OIDC/LDAP, ainsi que des exemples de configuration (docker-compose, YAML, r√®gles de proxy, options de cookies, etc.). Les explications sont techniques mais p√©dagogiques, adapt√©es √† un ing√©nieur cybers√©curit√© exp√©riment√©. Nous restons strictement sur des solutions self-hosted, sans recours √† des services SaaS.</p>
<h2 id="solutions-open-source-de-gestion-didentite-et-sso"><strong>Solutions open-source de gestion d‚Äôidentit√© et SSO</strong><a class="headerlink" href="#solutions-open-source-de-gestion-didentite-et-sso" title="Permanent link">&para;</a></h2>
<p>Plusieurs projets proposent de centraliser l‚Äôauthentification en mode self-hosted. Voici une comparaison technique :</p>
<ul>
<li>
<p><strong>Keycloak</strong>  ‚Äì Solution mature g√©r√©e par Red Hat. Propose une interface d‚Äôadministration riche et un  <strong>gestionnaire d‚Äôidentit√©s</strong>  complet. Supporte nativement  <strong>OAuth2 / OpenID Connect (OIDC)</strong>  et  <strong>SAML</strong>, avec prise en charge d‚Äôune base d‚Äôutilisateurs interne ou de f√©d√©ration LDAP/AD  . Keycloak g√®re aussi les MFA (TOTP, WebAuthn/FIDO2 avec YubiKey, etc.) et les logins sociaux (Google, GitHub‚Ä¶)  . On peut l‚Äôex√©cuter en conteneur Docker ou sur Kubernetes, avec bases SQL pour stocker les donn√©es  . Keycloak est extensible : on peut ajouter des extensions Java, th√®mes personnalis√©s, ou connecteurs RADIUS via des extensions communautaires  .</p>
</li>
<li>
<p><strong>Authentik</strong>  ‚Äì IdP open-source r√©cent, moderne et ‚Äúconteneur-friendly‚Äù  . Authentik fournit √† la fois une interface web d‚Äôadmin conviviale et une API. Il supporte  <strong>OIDC, OAuth2 et SAML</strong>  pour les applications clientes, et peut f√©d√©rer vers un annuaire LDAP existant  . Authentik met l‚Äôaccent sur les flux d‚Äôauthentification dynamiques et l‚Äô¬´ adaptive MFA ¬ª. Il g√®re le  <strong>MFA</strong>  par TOTP,  <strong>WebAuthn/passkeys</strong>  (FIDO2) et m√™me l‚Äôauthentification par push ou static tokens (codes de secours)  . Il ne prend pas en charge RADIUS en natif, mais peut s‚Äôint√©grer via un proxy externe. Authentik est con√ßu pour tourner sur Docker/Kubernetes (base PostgreSQL), avec une documentation claire.</p>
</li>
<li>
<p><strong>Authelia</strong>  ‚Äì ¬´ portail SSO ¬ª sp√©cialis√© pour √™tre associ√© √† un reverse-proxy existant  . Authelia est un serveur d‚Äô<strong>authentification multi-facteur (IAM)</strong>  et SSO qui se place en ¬´ gatekeeper ¬ª devant les applications web. C‚Äôest un fournisseur  <strong>OIDC</strong>  certifi√© OpenID‚Ñ¢  , avec support des logins via cookies de session, headers de confiance ou OIDC. Authelia mise sur la l√©g√®ret√© (conteneur &lt;20‚ÄØMo) et la rapidit√©. Il propose MFA/TOTP,  <strong>WebAuthn (FIDO2)</strong>, notifications push et passkeys  , ainsi qu‚Äôune gestion fine des politiques d‚Äôacc√®s. Il se d√©ploie g√©n√©ralement en conteneur unique associ√© √† un proxy (Traefik, Nginx, etc.) et peut utiliser Redis/Mongo pour les sessions, LDAP pour le backend utilisateur, etc. Authelia ne cherche pas √† remplacer un annuaire LDAP complet mais sert de point d‚Äôauthentification central. Il fournit une UI simple pour le flux de login et de MFA  .</p>
</li>
<li>
<p><strong>LemonLDAP::NG</strong>  ‚Äì Plateforme AAA (authentification, autorisation, audit) fran√ßaise, tr√®s compl√®te et modulaire  . LemonLDAP::NG propose un  <strong>portail SSO</strong>  avec support natif de nombreux backends d‚Äôauthentification (LDAP, AD, Kerberos, base de donn√©es, certificats SSL, OAuth, etc.)  . Il impl√©mente  <strong>SAML, CAS et OpenID Connect</strong>(flux standard OIDC/OAuth2)  . On peut l‚Äôutiliser comme IDP SAML/OIDC, ou comme passerelle entre protocoles (ex. CAS‚ÜíSAML, etc.). LemonLDAP g√®re la MFA via des modules vari√©s : TOTP/HOTP (compatible FreeOTP, Google Authenticator), WebAuthn (FIDO2), OTP Yubico et plus (e-mail, RADIUS, Okta, REST externe‚Ä¶)  . L‚Äôinterface d‚Äôadmin (Manager) est compl√®te mais plus complexe √† prendre en main. LemonLDAP::NG est tr√®s extensible (plugins Perl, r√®gles avanc√©es) et supporte Docker/Kubernetes pour l‚ÄôUI, le portail et la base de config.</p>
</li>
<li>
<p><strong>Autres solutions</strong>  ‚Äì On peut aussi citer d‚Äôautres projets comme GLUU (mature en entreprise) ou Ory/Hydra pour OIDC, voire Apereo CAS. Mais pour un homelab, les solutions ci-dessus sont en g√©n√©ral suffisantes.</p>
</li>
</ul>
<p>En synth√®se,  <strong>Keycloak</strong>  et  <strong>Authentik</strong>  sont de v√©ritables fournisseurs d‚Äôidentit√© (IdP) supportant SSO OIDC/SAML et de multiples m√©thodes MFA;  <strong>Authelia</strong>  joue plut√¥t le r√¥le d‚Äôauthentificateur ¬´ front-end ¬ª pour un reverse proxy, apportant MFA/TOTP/WebAuthn sans fournir de service annuaire complet;  <strong>LemonLDAP::NG</strong>  est une suite SSO tr√®s polyvalente multi-protocoles, orient√©e proxy et flux d‚Äôauthent. Les diff√©rences se trouvent dans la facilit√© de configuration (Keycloak/Authentik offrent UI modernes, Authelia et LemonLDAP demandent plus de configuration manuelle), l‚Äôint√©gration dans Docker (Keycloak et Authentik pr√™ts pour conteneurs, LemonLDAP plus traditionnel), et l‚Äô√©cosyst√®me (communaut√©, plugins, support entreprise)  .</p>
<h2 id="methodes-dauthentification-et-mfa-supportees"><strong>M√©thodes d‚Äôauthentification et MFA support√©es</strong><a class="headerlink" href="#methodes-dauthentification-et-mfa-supportees" title="Permanent link">&para;</a></h2>
<p>Les syst√®mes ci-dessus supportent plusieurs  <strong>m√©thodes d‚Äôauthentification</strong>  et de  <strong>double authentification (2FA/MFA)</strong>courantes :</p>
<ul>
<li>
<p><strong>TOTP (Time-based One-Time Password)</strong>  : codes √† usage unique g√©n√©r√©s par application mobile (Google Authenticator, FreeOTP, Authy‚Ä¶). Avantages : simple, ne requiert pas de r√©seau, bien support√©. Inconv√©nients : vuln√©rable au phishing, n√©cessite synchronisation horaire correcte. Presque tous les IdP/SSO (Keycloak, Authelia, Authentik, LemonLDAP) int√®grent le TOTP en MFA  . Par exemple, Keycloak propose une ¬´ authenticator app ¬ª TOTP int√©gr√©e  , et Authelia g√®re les OTP via TOTP dans sa configuration.</p>
</li>
<li>
<p><strong>WebAuthn / FIDO2 (incluant U2F)</strong>  : authentification par ¬´ cl√©s de s√©curit√© ¬ª (YubiKey, biom√©trie mobile, etc.) selon la norme W3C Web Authentication. Avantages : extr√™mement r√©sistante au phishing (la cl√© crypto prouve la l√©gitimit√© du site), UX fluide (p.ex. passkeys sur smartphone), peut remplacer le mot de passe. Limites : exige un appareil support√© (cl√© USB/NFC ou smartphone/ordinateur avec TPM), plus complexe √† d√©ployer. Keycloak supporte WebAuthn comme deuxi√®me facteur (m√™me utilis√© comme facteur primaire sans mot de passe)  . Authelia inclut le support WebAuthn (passkeys et U2F)  . Authentik le supporte √©galement et le recommande (c‚Äôest le seul facteur utilisable en tant que ¬´ passwordless ¬ª primaire)  . LemonLDAP::NG offre un plugin WebAuthn (attestation simple ou avanc√©e) et peut migrer des cl√©s U2F existantes vers WebAuthn  . Les cl√©s mat√©rielles YubiKey b√©n√©ficient de ces syst√®mes : en mode OTP (monodirectionnel) ou comme cl√© FIDO2 (WebAuthn/U2F).</p>
</li>
<li>
<p><strong>YubiKey OTP</strong>  : Jetons OTP sp√©cifiques de Yubico (1 OTP par toucher). Avantages : m√©thode √©prouv√©e, r√©silience contre attaque en ligne, fonctionne hors-ligne. Inconv√©nients : stocker secret Yubikey (s√©curit√©), format propri√©taire. LemonLDAP::NG fournit un module ¬´ Yubico OTP ¬ª pour int√©grer directement les cl√©s Yubico en second facteur  . (Cependant, comme WebAuthn couvre d√©j√† FIDO/U2F, l‚ÄôOTP de YubiKey est moins utilis√©).</p>
</li>
<li>
<p><strong>SMS OTP</strong>  : codes envoy√©s par SMS. Avantages : large compatibilit√© (aucune appli n√©cessaire). Inconv√©nients s√©rieux : vuln√©rable au SIM swapping, chiffrement SMS faible, peut √™tre intercept√©. Authentik et Authelia peuvent proposer le SMS en MFA (Authentik l‚Äôint√®gre en option, Authelia peut utiliser Twilio ou un fournisseur GSM)  . C‚Äôest souvent d√©conseill√© en priorit√©, mais utile en secours.</p>
</li>
<li>
<p><strong>Notification Push mobile</strong>  : authentification par notification sur smartphone (ex. Duo Mobile). Avantages : tr√®s pratique, s√©curit√© renforc√©e (requiert contr√¥le de l‚Äôappareil). Inconv√©nients : d√©pend d‚Äôun service push (souvent externe). Authelia supporte les notifications push (il mentionne explicitement ‚ÄúMobile Push Notifications‚Äù comme facteur support√©)  . Authentik n‚Äôa pas de push int√©gr√© nativement (on peut passer par Duo ou WebAuthn mobile).</p>
</li>
<li>
<p><strong>Autres facteurs</strong>  : En plus du mot de passe classique, on peut avoir des cl√©s statiques (codes de secours), OTP via e-mail, RADIUS externe, certificats TLS client, etc. Par exemple, LemonLDAP propose un module e-mail 2FA, et l‚Äôauthentification par annuaire (LDAP/AD) ou par certificat X.509 est possible comme facteur.</p>
</li>
</ul>
<p>Chaque m√©thode a ses usages : le  <strong>TOTP</strong>  reste standard pour un homelab,  <strong>WebAuthn</strong>  est recommand√© pour sa r√©sistance au phishing (p. ex. connectez une YubiKey ou un smartphone pour vous authentifier)  . Les solutions self-hosted int√®grent en g√©n√©ral ces MFA de base. Par exemple, Keycloak et Authentik autorisent TOTP et WebAuthn par d√©faut  ; Authelia propose TOTP et WebAuthn/Passkeys et m√™me push  ; LemonLDAP autorise TOTP, WebAuthn et YubiKey OTP  . Lors de l‚Äôint√©gration, on configurera le flux d‚Äôauthentification pour exiger un second facteur en fonction du profil ou de la politique (par exemple ¬´ 2FA n√©cessaire hors du r√©seau local ¬ª).</p>
<h2 id="cas-dusage-dans-un-homelab"><strong>Cas d‚Äôusage dans un homelab</strong><a class="headerlink" href="#cas-dusage-dans-un-homelab" title="Permanent link">&para;</a></h2>
<p>Voici comment ces solutions et m√©thodes peuvent prot√©ger des services typiques d‚Äôun homelab :</p>
<ul>
<li>
<p><strong>Vaultwarden (Bitwarden)</strong>  : Vaultwarden supporte l‚Äôauthentification OIDC en tant que client. On peut configurer Vaultwarden pour d√©l√©guer l‚Äôauthentification √† un IdP tel qu‚ÄôAuthelia ou Keycloak. Par exemple, avec Authelia on d√©finit des variables d‚Äôenvironnement pour activer le SSO et renseigner le client OIDC (client_id, secret, scopes, URL de redirection)  . Ainsi, l‚Äôutilisateur se connecte via Authelia (avec MFA) puis Vaultwarden re√ßoit les jetons OIDC. Authelia fournit par exemple un guide d‚Äôint√©gration montrant l‚Äôactivation du SSO dans Vaultwarden (voir variables  SSO_ENABLED=true,  SSO_CLIENT_ID=..., etc.)  .</p>
</li>
<li>
<p><strong>Nextcloud</strong>  : Nextcloud peut √™tre configur√© comme  <strong>SP SAML</strong>  ou  <strong>RP OIDC</strong>. Avec Keycloak ou Authentik, on active le plugin ‚ÄúOpenID Connect Login‚Äù ou ‚ÄúSSO/SAML‚Äù. Nextcloud demandera les attributs utilisateurs (nom, e-mail, identifiant, √©ventuellement groupe/quota). Par exemple, la documentation d‚ÄôAuthentik d√©crit l‚Äôusage des scopes OIDC (email,  profile,  openid) et de mappings d‚Äôattributs (groupes, quotas) via une ¬´ Property Mapping ¬ª pour Nextcloud  . Un point important : Nextcloud ne peut plus chiffrer c√¥t√© serveur si on n‚Äôutilise pas LDAP (le mot de passe n‚Äôest pas fourni en clair), donc il est recommand√© d‚Äôutiliser LDAP pour le chiffrement ou bien de l‚Äôabandonner si on fait du SSO OIDC/SAML  . L‚Äôint√©gration est largement document√©e, et Nextcloud cr√©era localement l‚Äôutilisateur apr√®s connexion unique.</p>
</li>
<li>
<p><strong>Proxmox VE</strong>  : Proxmox int√®gre un  <strong>auth source</strong>  OIDC √† partir de la version 7+. On peut ajouter un ¬´ realm ¬ª OIDC via la commande  pveum realm add ... --type openid  en pr√©cisant l‚ÄôURL du serveur d‚Äôidentit√©s (Issuer URL), l‚ÄôID et secret du client, le claim d‚Äôutilisateur (par d√©faut  username), et souvent l‚Äôoption  --autocreate 1  pour cr√©er automatiquement les utilisateurs lors du premier login  . Par exemple, configurer Keycloak : on cr√©e un client OIDC ‚ÄúProxmox‚Äù dans Keycloak (p. ex. ID ‚Äúpve‚Äù), puis sur chaque n≈ìud Proxmox :
<div class="highlight"><pre><span></span><code><span class="l l-Scalar l-Scalar-Plain">pveum realm add keycloak --type openid \</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">--issuer-url https://auth.domaine/realms/homelab \</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">--client-id pve --client-key &lt;secret&gt; \</span>
<span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">--username-claim username --autocreate 1</span>
</code></pre></div></p>
</li>
</ul>
<p>pveum realm add keycloak --type openid \
   --issuer-url https://auth.domaine/realms/homelab \
   --client-id pve --client-key <secret> \
   --username-claim username --autocreate 1
<div class="highlight"><pre><span></span><code><span class="k">[auth.generic_oauth]</span>
<span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Keycloak</span>
<span class="na">allow_sign_up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">VOTRE_ID_CLIENT</span>
<span class="na">client_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">VOTRE_SECRET</span>
<span class="na">scopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">openid email profile offline_access roles</span>
<span class="na">email_attribute_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">email</span>
<span class="na">login_attribute_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">username</span>
<span class="na">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://&lt;IDP&gt;/realms/homelab/protocol/openid-connect/auth</span>
<span class="na">token_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://&lt;IDP&gt;/realms/homelab/protocol/openid-connect/token</span>
<span class="na">api_url</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">https://&lt;IDP&gt;/realms/homelab/protocol/openid-connect/userinfo</span>
</code></pre></div></p>
<ul>
<li>
<p>Cet exemple (adapt√© de la doc officielle Grafana) montre comment pointer Grafana vers un IdP Keycloak  . Grafana obtient alors le login via Keycloak et peut mapper les r√¥les Keycloak sur ses r√¥les internes. Un processus similaire existe pour d‚Äôautres outils (Chronograf, Kibana, etc.).</p>
</li>
<li>
<p><strong>Autres services</strong>  : On peut de la m√™me fa√ßon prot√©ger Bitwarden, Paperless, Seafile, Vault, Homarr, etc. gr√¢ce aux int√©grations OIDC ou via le proxy. Par exemple, Imihc (gestion de photos), Uptime Kuma, etc. poss√®dent souvent une option ¬´ Authentification OIDC ¬ª ou bien on les place derri√®re Authelia.</p>
</li>
</ul>
<p>En r√©sum√©,  <strong>tous ces services b√©n√©ficient d‚Äôune couche SSO/MFA commune</strong>. Plut√¥t que de g√©rer un utilisateur local par application, l‚Äôauthentification est externalis√©e vers l‚ÄôIdP : l‚Äôutilisateur se logue une fois (avec MFA) sur l‚ÄôIdP, puis acc√®de √† toutes les applis associ√©es sans resaisir son mot de passe.</p>
<h2 id="architectures-type-avec-reverse-proxy-et-sso"><strong>Architectures type avec reverse proxy et SSO</strong><a class="headerlink" href="#architectures-type-avec-reverse-proxy-et-sso" title="Permanent link">&para;</a></h2>
<p>Une architecture fr√©quente dans un homelab consiste √† placer un  <strong>reverse proxy</strong>  (NGINX, NGINX Proxy Manager, Traefik, Caddy, etc.) devant les applications, et √† d√©l√©guer l‚Äôauthentification √† un service SSO/MFA. Voici deux sch√©mas courants :</p>
<ul>
<li><strong>NGINX Proxy + Authelia (auth_request)</strong>  : NGINX joue le r√¥le de proxy frontal. On utilise la directive  auth_request  pour que NGINX interroge Authelia avant de laisser passer la requ√™te. Par exemple, dans une configuration de site NGINX:</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">auth_request</span><span class="w"> </span><span class="s">/internal/authelia/authz</span><span class="p">;</span>
<span class="w">  </span><span class="kn">...</span>
<span class="err">}</span>
<span class="s">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/internal/authelia/authz</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://authelia:9091/api/verify?rd=https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="w">  </span><span class="kn">internal</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
-   Dans cet exemple, chaque acc√®s √† l‚Äôapplication d√©clenche un appel interne √† Authelia (/internal/authelia/authz). Authelia v√©rifie la session/MFA et renvoie 200 (si autoris√©) ou 401 (sinon). NGINX peut alors rediriger vers la page de login Authelia si n√©cessaire. On r√©cup√®re aussi les en-t√™tes  Remote-User/Groups/Email  avec  auth_request_setpour transmettre l‚Äôidentit√© √† l‚Äôapplication prot√©g√©  . L‚Äôint√©gration NGINX/Authelia n√©cessite le module  ngx_http_auth_request_module. Ce sch√©ma permet d‚Äôauthentifier n‚Äôimporte quelle application web (m√™me sans support OIDC natif) via Authelia. L‚Äôexemple officiel d‚ÄôAuthelia montre un usage d‚Äôauth_request /internal/authelia/authz;  et la r√©cup√©ration des variables  $remote_user,  $remote_groups  apr√®s authentification  .</p>
<ul>
<li>
<p><strong>Traefik + Authelia (Forward Auth Middleware)</strong>  : Avec Traefik v2+, on configure Authelia comme  <strong>middleware de forward auth</strong>. On d√©finit dans la stack Docker des labels Traefik pour activer l‚Äôauthentification. Par exemple (dans un  docker-compose.yml) :
<div class="highlight"><pre><span></span><code><span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">authelia</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">authelia/authelia</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># Route Authelia elle-m√™me</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.enable=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.authelia.rule=Host(`auth.example.com`)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.authelia.entrypoints=https</span>
<span class="w">      </span><span class="c1"># D√©finition du middleware Authelia (forwardAuth)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.middlewares.authelia.forwardAuth.address=http://authelia:9091/api/authz/forward-auth</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.middlewares.authelia.forwardAuth.trustForwardHeader=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.middlewares.authelia.forwardAuth.authResponseHeaders=Remote-User,Remote-Groups</span>
<span class="w">  </span><span class="nt">app-secure</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik/whoami</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.enable=true</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.whoami-secure.rule=Host(`whoami-secure.example.com`)</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.whoami-secure.entrypoints=https</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik.http.routers.whoami-secure.middlewares=authelia@docker</span>
<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
<span class="w">  </span><span class="nt">authelia</span><span class="p">:</span>
</code></pre></div></p>
</li>
<li>
<p>Dans cet exemple, Traefik expose Authelia sur  auth.example.com. Le service  app-secure  (ici  whoami-secure) est prot√©g√© par le middleware  authelia@docker  . Ce middleware appelle l‚Äôendpoint Authelia (/api/authz/forward-auth) pour chaque requ√™te. Si l‚Äôutilisateur n‚Äôest pas authentifi√©, il est redirig√© vers la page de login Authelia. Cette configuration montre l‚Äôusage de  traefik.http.middlewares.authelia.forwardAuth.address: 'http://authelia:9091/api/authz/forward-auth'  pour d√©finir l‚Äôauthentificateur  . C‚Äôest un sch√©ma tr√®s modulable : toutes les applications derri√®re Traefik peuvent √™tre prot√©g√©es ainsi (avec labels similaires).</p>
</li>
<li>
<p><strong>SSO via OIDC/LDAP</strong>  : Alternativement, certaines applications peuvent directement se connecter √† un IdP OIDC ou √† un annuaire. Par exemple, Nextcloud peut se lier en LDAP √† Keycloak/FreeIPA, ou agir en SP SAML/OIDC avec Keycloak. Dans ce cas, le ‚Äúreverse proxy‚Äù ne fait que la redirection initiale ; l‚Äôauthentification se fait dans l‚Äôapplication via l‚ÄôIdP. Par exemple, un flux OIDC classique : l‚Äôutilisateur acc√®de √† l‚Äôapp (via proxy), l‚Äôapp le redirige vers Keycloak pour login, puis Keycloak redirige de retour avec un code. Ce mod√®le requiert que l‚Äôapplication cliente supporte OIDC/SAML (Grafana, Nextcloud, Jenkins, etc. ont ce support).</p>
</li>
</ul>
<p>Ces architectures peuvent √™tre combin√©es : ex. Keycloak (OIDC IdP) + Traefik + Authelia (pour les apps sans support OIDC). L‚Äôid√©e cl√© est d‚Äôavoir  <strong>un point unique d‚Äôauthentification</strong>  (avec MFA) et des r√®gles de proxy/redirection centralis√©es.</p>
<h2 id="exemples-de-configuration"><strong>Exemples de configuration</strong><a class="headerlink" href="#exemples-de-configuration" title="Permanent link">&para;</a></h2>
<p>Voici quelques extraits concrets :</p>
<ul>
<li>
<p><strong>Docker Compose (Authelia + Traefik)</strong>  ‚Äì Exemple simplifi√© tir√© d‚Äôun guide officiel  :
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">traefik</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">traefik:latest</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--providers.docker</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;80:80&#39;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;443:443&#39;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock:ro</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.enable=true&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.routers.dashboard.rule=Host(`traefik.example.com`)&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.routers.dashboard.entrypoints=https&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.routers.dashboard.middlewares=authelia@docker&quot;</span>
<span class="w">  </span><span class="nt">authelia</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">authelia/authelia:latest</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.enable=true&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.routers.authelia.rule=Host(`auth.example.com`)&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.routers.authelia.entrypoints=https&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.middlewares.authelia.forwardAuth.address=http://authelia:9091/api/authz/forward-auth&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.middlewares.authelia.forwardAuth.trustForwardHeader=true&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;traefik.http.middlewares.authelia.forwardAuth.authResponseHeaders=Remote-User,Remote-Groups&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./authelia/config:/config</span>
<span class="nt">networks</span><span class="p">:</span>
<span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">authelia</span><span class="p">:</span>
</code></pre></div></p>
</li>
<li>
<p>Ici,  <strong>Authelia</strong>  est expos√©e sur  auth.example.com  (router Authelia) et on d√©finit un  <strong>middleware</strong>  Authelia (forwardAuth) utilis√© par le router  dashboard. Le middleware appellera  http://authelia:9091/api/authz/forward-auth. Ce sch√©ma est similaire √† l‚Äôexemple de l‚Äôarticle Authelia  .</p>
</li>
<li>
<p><strong>Configuration NGINX (auth_request)</strong>  ‚Äì Extrait type (d‚Äôapr√®s la documentation Authelia) pour prot√©ger un site Nextcloud :
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kn">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="s">ssl</span><span class="p">;</span>
<span class="w">  </span><span class="kn">server_name</span><span class="w"> </span><span class="s">cloud.example.com</span><span class="p">;</span>
<span class="w">  </span><span class="c1"># TLS config omitted...</span>
<span class="w">  </span><span class="c1"># Auth Request vers Authelia</span>
<span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">auth_request</span><span class="w"> </span><span class="s">/internal/authelia/authz</span><span class="p">;</span>
<span class="w">    </span><span class="kn">auth_request_set</span><span class="w"> </span><span class="nv">$user</span><span class="w">  </span><span class="nv">$upstream_http_remote_user</span><span class="p">;</span>
<span class="w">    </span><span class="kn">auth_request_set</span><span class="w"> </span><span class="nv">$email</span><span class="w"> </span><span class="nv">$upstream_http_remote_email</span><span class="p">;</span>
<span class="w">    </span><span class="kn">error_page</span><span class="w"> </span><span class="mi">401</span><span class="w"> </span><span class="p">=</span><span class="mi">302</span><span class="w"> </span><span class="s">https://auth.example.com/?rd=</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="w">    </span><span class="c1"># ...</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://nextcloud_backend</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="kn">location</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">/internal/authelia/authz</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kn">internal</span><span class="p">;</span>
<span class="w">    </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://authelia:9091/api/verify?rd=https://cloud.example.com</span><span class="nv">$request_uri</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p>Ce snippet montre l‚Äôusage de  auth_request /internal/authelia/authz;  pour d√©l√©guer l‚Äôauthentification √† Authelia  . Les directives  auth_request_set  capturent l‚ÄôUID  $remote_user  et d‚Äôautres en-t√™tes renvoy√©s par Authelia. En cas de non-autorisation (code 401), on redirige vers  auth.example.com  pour se logger (param√®tre  rd  = redirect apr√®s login). Cet exemple est inspir√© de la configuration recommand√©e d‚ÄôAuthelia pour NGINX  .</p>
</li>
<li>
<p><strong>Configuration Grafana (OIDC)</strong>  ‚Äì Extrait du fichier  grafana.ini  pour Keycloak  :</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">[auth.generic_oauth]</span>
<span class="na">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
<span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">Keycloak-OAuth</span>
<span class="na">client_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pve-grafana</span>
<span class="na">client_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">VOTRE_SECRET</span>
<span class="na">scopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">openid email profile roles</span>
<span class="na">email_attribute_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">email</span>
<span class="na">login_attribute_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">username</span>
<span class="na">auth_url</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">https://keycloak.example.com/realms/homelab/protocol/openid-connect/auth</span>
<span class="na">token_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">https://keycloak.example.com/realms/homelab/protocol/openid-connect/token</span>
<span class="na">api_url</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s">https://keycloak.example.com/realms/homelab/protocol/openid-connect/userinfo</span>
</code></pre></div>
-   Ce bloc configure Grafana pour utiliser Keycloak en OIDC. Il d√©finit l‚Äôauth_url  (point d‚Äôautorisation OIDC), le  token_url, ainsi que  client_id/secret. Les attributs utilisateur (email,  username) sont mapp√©s depuis les claims OIDC de Keycloak  .</p>
<ul>
<li><strong>Options de cookies</strong>  ‚Äì Les cookies de session et d‚Äôauthentification doivent √™tre s√©curis√©s. Il est recommand√© de d√©finir le flag  <strong>Secure</strong>  (transmission seulement sur HTTPS) et  <strong>HttpOnly</strong>  (inaccessible aux scripts)  , ainsi que l‚Äôattribut  <strong>SameSite=Lax</strong>  (ou Strict) pour mitiger le CSRF  . Par exemple, dans la config Authelia, on pr√©cise :</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="nt">session</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cookies</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">authelia_session</span>
<span class="w">      </span><span class="nt">domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
<span class="w">      </span><span class="nt">same_site</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lax</span>
<span class="w">      </span><span class="nt">secure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">http_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
-   Cela suit les bonnes pratiques OWASP sur la gestion de session  . De m√™me, limiter le  Domain  √† l‚Äôexact domaine √©vite le partage de cookies entre sous-domaines  .</p>
<h2 id="resume"><strong>R√©sum√©</strong><a class="headerlink" href="#resume" title="Permanent link">&para;</a></h2>
<p>Pour un homelab self-hosted, il est possible de mettre en place un  <strong>syst√®me centralis√© de comptes</strong>  avec MFA en utilisant uniquement des solutions open-source. En fonction des besoins et de la taille de l‚Äôinstallation, on choisira par exemple Keycloak ou Authentik pour un IdP complet (avec OIDC/SAML/LDAP), ou Authelia/LemonLDAP::NG pour une approche plus ‚Äúproxy-based‚Äù. Les m√©thodes MFA standard (TOTP, WebAuthn, YubiKey, etc.) sont g√©n√©ralement support√©es par ces outils  . On int√®gre ensuite les applications (Vaultwarden, Nextcloud, Proxmox, Grafana‚Ä¶) derri√®re un reverse-proxy (NGINX, Traefik) configur√© pour rediriger les utilisateurs vers le fournisseur d‚Äôidentit√©s. Des exemples de configuration docker-compose, NGINX/Trafik labels et directives d‚Äôauthentification ont √©t√© pr√©sent√©s pour illustrer ce mod√®le. Cette architecture  <strong>SSO + MFA</strong>  am√©liore nettement la s√©curit√© (mot de passe unique, double facteur, cookies prot√©g√©s) tout en offrant une exp√©rience utilisateur fluide.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.expand", "toc.integrate", "content.code.annotate", "search.highlight", "search.suggest"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.56ea9cef.min.js"></script>
      
    
  </body>
</html>